<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." name="G04GiskardAnt">

	<echo message="Starting ANT build in root ${GISKARD}" />

	<property name="GISKARD_DEV" value="${GISKARD}/Dev" />
	<property name="GISKARD_BIN" value="${GISKARD}/Bin" />

	<property name="javac.debuglevel" value="source,lines,vars" />
	<property name="javac.target" value="1.8" />
	<property name="javac.source" value="1.8" />
	<property name="javac.bindir" value="ant" />
	
	<property name="GISKARD_MOD" value="${GISKARD_DEV}/Giskard/Mod" />
	<property name="GISKARD_MOD_BIN" value="${GISKARD_MOD}/${javac.bindir}" />
	<property name="GISKARD_APP_SRC" value="${GISKARD_DEV}/Giskard/App/src" />

	<macrodef name="giskard-build-mod">
		<attribute name="vendor" />
		<attribute name="module" />
		<attribute name="ver" />

		<sequential>
			
			<delete dir="${GISKARD_MOD_BIN}" />
			<mkdir dir="${GISKARD_MOD_BIN}" />
			
			<javac debug="true"
			       debuglevel="${javac.debuglevel}"
			       destdir="${GISKARD_MOD_BIN}"
			       includeantruntime="false"
			       source="${javac.source}"
			       target="${javac.target}">
				<src path="${GISKARD_MOD}/src" />
			</javac>

			<local name="targetname" />
			<local name="prjdir" />
			<local name="bindir" />
			
			<property name="prjdir" value="${GISKARD_DEV}/Mod/@{vendor}/@{module}" />
			<property name="bindir" value="${prjdir}/${javac.bindir}" />
			<property name="targetname" value="@{vendor}_@{module}_@{ver}" />

			<delete dir="${bindir}" />
			<mkdir dir="${bindir}" />
			
			<javac debug="true"
			       debuglevel="${javac.debuglevel}"
			       destdir="${bindir}"
			       includeantruntime="false"
			       source="${javac.source}"
			       target="${javac.target}">
				<classpath>
					<path path="${GISKARD_MOD_BIN}" />
					<fileset dir="${prjdir}/lib" includes="**.*.jar" erroronmissingdir="false" />
				</classpath>
				<src path="${prjdir}/src" />
			</javac>

			<jar destfile="${GISKARD_BIN}/Mod/${targetname}.jar">
				<fileset dir="${bindir}" />
			</jar>

			<copy todir="${GISKARD_BIN}/Ext/@{targetname}" failonerror="false">
				<fileset dir="${prjdir}/lib" erroronmissingdir="false" />
			</copy>

		</sequential>

	</macrodef>

	<macrodef name="giskard-build-app">
		<attribute name="vendor" />
		<attribute name="module" />
		<attribute name="ver" />

		<sequential>
			<local name="targetname" />
			<local name="prjdir" />
			<local name="bindir" />
			<property name="prjdir" value="${GISKARD_DEV}/App/@{vendor}/@{module}" />
			<property name="bindir" value="${prjdir}/${javac.bindir}" />
			<property name="targetname" value="@{vendor}@{module}-@{ver}" />

			<delete dir="${bindir}" />
			<mkdir dir="${bindir}" />

			<javac debug="true"
			       debuglevel="${javac.debuglevel}"
			       destdir="${bindir}"
			       includeantruntime="false"
			       source="${javac.source}"
			       target="${javac.target}">
				<src path="${GISKARD_MOD}" />
				<src path="${GISKARD_APP_SRC}" />
				<src path="${prjdir}/src" />
			</javac>

			<jar destfile="${GISKARD_BIN}/App/${targetname}.jar">
				<manifest>
					<attribute name="Main-Class" value="me.giskard.app.GiskardApp" />
					<attribute name="Class-Path" value="." />
				</manifest>

				<fileset dir="${bindir}" />
				<fileset dir="${prjdir}/cfg" />
			</jar>
		</sequential>

	</macrodef>
</project>
